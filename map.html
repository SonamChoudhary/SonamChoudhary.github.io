<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>MAP</title>
    <script src="https://d3js.org/d3.v4.js"></script>
    <style>
        path {
            fill: none;
            stroke-width: 1px;
            stroke: #222;
        }
        .province:hover {
            fill: #666;
        }
        .hidden {
        display: none;
        }
        div.tooltip {
        color: #222;
        background-color: #fff;
        padding: .5em;
        text-shadow: #f5f5f5 0 1px 0;
        border-radius: 2px;
        opacity: 0.9;
        position: absolute;
        }
    </style>
</head>
<body background="bk_image.jpg">
<svg width="1800" height="600">
    <g id="mapLayer"></g>
    <g id="cityLayer"></g>
</svg>

<script type="text/javascript">
    {
        let svg = d3.select("svg");
        let width = parseInt(svg.attr("width"));
        let height = parseInt(svg.attr("height"));

        let projection = d3.geoAlbersUsa()
            .translate([width / 2, height / 2])
            .scale([1000]);

        let path = d3.geoPath().projection(projection);

        // Load in GeoJSON data
        d3.json("us-states.json", function (json) {
            d3.select("#mapLayer").selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("fill","#ADD8E6");
        });

        var tooltip = d3.select('body').append('div')
            .attr('class', 'hidden tooltip');
        d3.csv("data.csv", function (data) {
            d3.select("#cityLayer").selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) {
                    return projection([d.LONGITUDE, d.LATITUDE])[0];
                })
                .attr("cy", function (d) {
                    return projection([d.LONGITUDE, d.LATITUDE])[1];
                })
                .attr("r", 5)
                .style("fill", "#FF0000")
                .style("opacity", 0.8)
                 .on('mousemove', function(d) {
                    var mouse = d3.mouse(svg.node()).map(function(d) {
                        return parseInt(d);
                    })
                    tooltip.classed('hidden', false)
                        .attr('style', 'left:' + (mouse[0] + 15) +
                                'px; top:' + (mouse[1] - 35) + 'px')
                        .html(d.STATION_NAME);
                })
                .on('mouseout', function() {
                    tooltip.classed('hidden', true);
                })
                .on("click", function(d){
                    console.log(d.STATION_NAME);
                });
        });
    }
</script>
</body>
</html>